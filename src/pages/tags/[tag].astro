---
import type {
	InferGetStaticParamsType,
	InferGetStaticPropsType,
	GetStaticPaths,
} from 'astro';
import Layout from '@/layouts/Layout.astro';
import BlogPost from '@/components/BlogPost.astro';

export const getStaticPaths = (async () => {
	const allPosts = await Astro.glob('../posts/*.md');
	const uniqueTags = [
		...new Set(allPosts.map((post) => post.frontmatter.tags).flat()),
	];

	// const returnedParams = uniqueTags.map((tag) => ({
	// 	params: { tag },
	// 	props: { posts: allPosts },
	// }));
	// console.log(returnedParams);
	return uniqueTags.map((tag) => {
		const filteredPosts = allPosts.filter((post) =>
			post.frontmatter.tags.includes(tag)
		);
		return {
			params: { tag },
			props: { posts: filteredPosts },
		};
	});
}) satisfies GetStaticPaths;

type Params = InferGetStaticParamsType<typeof getStaticPaths>;
type Props = InferGetStaticPropsType<typeof getStaticPaths>;

const { tag } = Astro.params as Params;
const { posts } = Astro.props;
---

<Layout title={tag}>
	<div class="p-10">
		<h1 class="text-mutedTxt">Posts tagged with: {tag}</h1>
		<ul>
			{
				posts.map((post) => (
					<BlogPost url={post.url} title={post.frontmatter.title} />
				))
			}
		</ul>
	</div>
</Layout>
